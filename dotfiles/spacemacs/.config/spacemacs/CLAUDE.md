# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is a Spacemacs configuration directory that's part of the CARBS dotfiles system. It contains the primary Spacemacs init file (`init.el`) which configures Emacs with Vim-style keybindings and various development layers.

## File Structure

- `init.el`: Main Spacemacs configuration file with three core functions:
  - `dotspacemacs/layers`: Layer configuration and package selection
  - `dotspacemacs/init`: Initial startup settings (fonts, themes, keybindings)
  - `dotspacemacs/user-config`: User-specific runtime configuration
- `bak-init.el`: Backup of previous init.el configuration
- `elfeed.org`: RSS feed configuration (currently empty)
- `.spacemacs.env`: Environment variables loaded by Spacemacs

## Key Configuration Details

### Active Layers

The configuration enables these Spacemacs layers (init.el:34-73):
- **Languages**: lua, html, javascript, csv, toml, yaml, python, ansible, markdown, emacs-lisp
- **Development**: lsp, auto-completion, syntax-checking, version-control, git, treemacs
- **Editor**: better-defaults, helm, multiple-cursors, spell-checking
- **Org mode**: org-roam, org-roam-ui, org-appear, org-transclusion, verb
- **AI**: llm-client with gptel (configured for Perplexity API)
- **Python**: Uses LSP backend with `pet` for virtualenv management

### Python Environment

Python layer configuration (init.el:69-72):
- Virtualenv management: `pet` (Python Environment Tool)
- Backend: LSP
- Integration with project-local environments

### Org Mode Configuration

Org mode settings in `dotspacemacs/user-config` (init.el:587-608):
- Agenda file: `~/org/todo-general.org`
- Org-roam directory: `~/org/roam/`
- Screenshot tool: `flameshot` with 3-second delay
- Roam template: `~/org/templates/roam-default.template`
- Roam graph viewer: Firefox Developer Edition

### AI Integration (gptel)

Configuration for Perplexity API (init.el:611-615):
- Backend: Perplexity
- Model: "sonar"
- API key source: `.authinfo` file (via `gptel-api-key-from-auth-source`)

### Appearance and Behavior

- Editing style: Vim mode (init.el:154)
- Font: Source Code Pro, 10pt (init.el:250-253)
- Themes: spacemacs-dark (primary), spacemacs-light (init.el:229-230)
- Leader key: `SPC` (init.el:259)
- Major mode leader: `,` (init.el:274)
- Line numbers: Disabled by default (init.el:437)
- Undo system: `undo-fu` (init.el:487)
- Auto-save location: cache directory (init.el:314)

## Editing the Configuration

### Modifying Layers

To add or remove layers, edit the `dotspacemacs-configuration-layers` list in `dotspacemacs/layers`:

```elisp
dotspacemacs-configuration-layers
'(
   existing-layer
   new-layer  ; Add new layer here
   (layer-with-config :variables
       var-name value)
)
```

### Adding User Configuration

Add custom elisp code in the `dotspacemacs/user-config` function (after init.el:580). This runs at the end of Spacemacs startup.

### Testing Changes

After editing `init.el`:
1. Reload configuration: `SPC f e R` (spacemacs/reload-configuration)
2. Restart Emacs if layer changes don't take effect
3. Install new packages: `SPC f e R` or restart

## Common Operations

### Spacemacs Key Bindings

- `SPC`: Leader key for all Spacemacs commands
- `SPC f e d`: Open init.el
- `SPC f e R`: Reload configuration
- `SPC q R`: Restart Emacs
- `,`: Major mode leader (language-specific commands)

### Package Management

- Packages are automatically installed based on layers
- Manual package list at init.el:633-681 (auto-generated)
- Package installation mode: `used-only` (removes unused packages)

### Python Development

- LSP server starts automatically in Python files
- Virtualenv detected via `pet` tool
- Configure per-project Python environment before editing

### Org Mode

- Capture todo: `SPC a o c` then select "t" template
- Open agenda: `SPC a o a`
- Org-roam find: `SPC a o r f`
- Org-roam insert: `SPC a o r i`

## Integration with CARBS

This configuration is deployed as part of the CARBS dotfiles system using GNU Stow. The directory structure is:
- Location: `dotfiles/spacemacs/.config/spacemacs/`
- Stow target: `~/.config/spacemacs/`
- Deployment: Run `stow spacemacs` from `dotfiles/` directory

## Important Notes

- Do not edit below the "Do not write anything past this comment" line (init.el:621) - Emacs manages `custom-set-variables` automatically
- The `dotspacemacs/emacs-custom-settings` function is auto-generated by Emacs customize interface
- Uses Spacemacs "develop" branch with emacs-git on Arch Linux
- Lazy layer installation enabled for packages not in the configuration-layers list
